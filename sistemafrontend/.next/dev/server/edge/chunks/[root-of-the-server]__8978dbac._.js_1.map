{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { MiddlewareConfig, NextRequest, NextResponse } from \"next/server\";\nimport { jwtDecode } from \"jwt-decode\";\n\nconst publicRoutes = [\n  { path: \"/sign-in\", whenAuthenticated: \"redirect\" },\n  { path: \"/register\", whenAuthenticated: \"redirect\" },\n  { path: \"/termos-e-privacidade\", whenAuthenticated: \"next\" },\n] as const;\n\nconst REDIRECT_WHEN_NOT_AUTHENTICATED = \"/sign-in\";\n\nexport function middleware(request: NextRequest) {\n  const url = request.nextUrl.pathname;\n  const publicUrl = publicRoutes.find((route) => url === route.path);\n  const tokenCookie = request.cookies.get(\"token\");\n  const token = tokenCookie?.value;\n\n  if (!token && !publicUrl) {\n    const redirectPath = request.nextUrl.clone();\n    redirectPath.pathname = REDIRECT_WHEN_NOT_AUTHENTICATED;\n\n    return NextResponse.redirect(redirectPath);\n  }\n\n  if (token && publicUrl) {\n    if (publicUrl.whenAuthenticated === \"redirect\") {\n      const redirectPath = request.nextUrl.clone();\n      redirectPath.pathname = \"/\";\n\n      return NextResponse.redirect(redirectPath);\n    }\n\n    return NextResponse.next();\n  }\n\n  if (token && !publicUrl) {\n    //Verifica se o jwt está expirado\n\n    // Decodifica o token\n    const decoded = jwtDecode<{ exp: number }>(token);\n\n    // Pega a data de expiração\n    const exp = decoded.exp; // em segundos\n\n    // Data atual em segundos\n    const now = Math.floor(Date.now() / 1000);\n\n    if (exp < now) {\n      // Token expirado\n      const redirectPath = request.nextUrl.clone();\n      redirectPath.pathname = \"/sign-in\";\n      return NextResponse.redirect(redirectPath);\n    }\n  }\n  return NextResponse.next();\n}\n\nexport const config: MiddlewareConfig = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico).*)',\n  ],\n}"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,eAAe;IACnB;QAAE,MAAM;QAAY,mBAAmB;IAAW;IAClD;QAAE,MAAM;QAAa,mBAAmB;IAAW;IACnD;QAAE,MAAM;QAAyB,mBAAmB;IAAO;CAC5D;AAED,MAAM,kCAAkC;AAEjC,SAAS,WAAW,OAAoB;IAC7C,MAAM,MAAM,QAAQ,OAAO,CAAC,QAAQ;IACpC,MAAM,YAAY,aAAa,IAAI,CAAC,CAAC,QAAU,QAAQ,MAAM,IAAI;IACjE,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC;IACxC,MAAM,QAAQ,aAAa;IAE3B,IAAI,CAAC,SAAS,CAAC,WAAW;QACxB,MAAM,eAAe,QAAQ,OAAO,CAAC,KAAK;QAC1C,aAAa,QAAQ,GAAG;QAExB,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IAAI,SAAS,WAAW;QACtB,IAAI,UAAU,iBAAiB,KAAK,YAAY;YAC9C,MAAM,eAAe,QAAQ,OAAO,CAAC,KAAK;YAC1C,aAAa,QAAQ,GAAG;YAExB,OAAO,gMAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,SAAS,CAAC,WAAW;QACvB,iCAAiC;QAEjC,qBAAqB;QACrB,MAAM,UAAU,IAAA,2KAAS,EAAkB;QAE3C,2BAA2B;QAC3B,MAAM,MAAM,QAAQ,GAAG,EAAE,cAAc;QAEvC,yBAAyB;QACzB,MAAM,MAAM,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;QAEpC,IAAI,MAAM,KAAK;YACb,iBAAiB;YACjB,MAAM,eAAe,QAAQ,OAAO,CAAC,KAAK;YAC1C,aAAa,QAAQ,GAAG;YACxB,OAAO,gMAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IACA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAA2B;IACtC,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}